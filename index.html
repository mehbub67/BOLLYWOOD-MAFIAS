<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>BOLLYWOOD MAFIA</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial}
body{background:#000;color:#fff;overflow:hidden}

/* SCREENS */
.screen{position:absolute;inset:0;display:none}
.screen.active{display:flex}

/* MENU */
#menu{
  background:url('menu/menu_bg.jpg') center/cover no-repeat;
  justify-content:center;
  align-items:center;
}
.menu-box{
  background:rgba(0,0,0,.75);
  padding:20px;
  border-radius:16px;
  width:90%;
  max-width:420px;
  text-align:center;
}
.menu-btn{
  width:100%;
  padding:14px;
  margin-top:12px;
  font-size:18px;
  border-radius:12px;
  border:none;
  background:#e91e63;
  color:#fff;
}

/* GAME */
#game{background:#111}

/* WORLD */
#world{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  width:360px;
  height:100%;
  overflow:hidden;
}

/* ROAD */
#road{
  position:absolute;
  left:80px;
  width:200px;
  height:100%;
  background:url('road/road_city.png') repeat-y center/contain;
}

/* CITY SIDES */
.city{
  position:absolute;
  top:0;
  width:80px;
  height:100%;
}
#leftCity{left:0}
#rightCity{right:0}

/* BUILDINGS */
.building{
  position:absolute;
  width:80px;
  height:120px;
  background-size:cover;
}

/* CARS */
.car{
  position:absolute;
  width:48px;
  height:90px;
  background-size:contain;
  background-repeat:no-repeat;
}

/* NPC HUMAN (SPRITE) */
.human{
  position:absolute;
  width:32px;
  height:48px;
  background:url('sprites/npc/npc_topdown_walk.png') 0 0 no-repeat;
  background-size:128px 48px; /* 4 frames */
}

/* PLAYER */
#player{bottom:120px}

/* HUD */
#hud{
  position:absolute;
  top:8px;left:8px;right:8px;
  display:flex;
  justify-content:space-between;
  font-size:14px;
}
#wanted{color:gold}

/* MISSION */
#mission{
  position:absolute;
  top:36px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,.6);
  padding:6px 12px;
  border-radius:8px;
  font-size:13px;
}

/* CONTROLS */
#controls{
  position:absolute;
  bottom:0;left:0;right:0;
  height:110px;
  display:flex;
  justify-content:space-around;
  align-items:center;
  background:linear-gradient(#222,#000);
}
.ctrl{
  width:72px;height:72px;
  border-radius:50%;
  background:radial-gradient(circle,#555,#111);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:24px;
  user-select:none;
}
#nitro{background:radial-gradient(circle,#ffd700,#b8860b);color:#000}
</style>
</head>

<body>

<!-- AUDIO -->
<audio id="menuMusic" src="sounds/menu_music.mp3" loop></audio>
<audio id="engineSound" src="sounds/engine.mp3" loop></audio>
<audio id="nitroSound" src="sounds/nitro.mp3"></audio>
<audio id="crashSound" src="sounds/crash.mp3"></audio>

<!-- MENU -->
<div id="menu" class="screen active">
  <div class="menu-box">
    <h1>BOLLYWOOD MAFIA</h1>
    <p>Coins: <span id="mCoins">0</span></p>
    <p>Level: <span id="mLevel">1</span></p>
    <button class="menu-btn" onclick="startGame()">START</button>
  </div>
</div>

<!-- GAME -->
<div id="game" class="screen">
  <div id="world">
    <div id="leftCity" class="city"></div>
    <div id="rightCity" class="city"></div>
    <div id="road"></div>
    <div id="player" class="car"></div>
  </div>

  <div id="hud">
    <div>HP: <span id="hp">100</span></div>
    <div id="wanted">☆☆☆☆☆</div>
    <div>Coins: <span id="coins">0</span></div>
  </div>

  <div id="mission"></div>

  <div id="controls">
    <div class="ctrl" id="leftBtn">◀</div>
    <div class="ctrl" id="nitro">N</div>
    <div class="ctrl" id="rightBtn">▶</div>
  </div>
</div>

<script>
/* SAVE */
let save=JSON.parse(localStorage.getItem("mafiaSave")||"{}");
let coins=save.coins||0;
let level=save.level||1;

/* STATE */
let roadLeft=80, roadRight=80+200-48;
let x=roadLeft+80, moveDir=0;
let hp=100,wanted=0,score=0,speed=4;
let npcs=[],humans=[],police=[],buildings=[];

/* PLAYER */
player.style.backgroundImage="url('cars/player_red.png')";
mCoins.textContent=coins;
mLevel.textContent=level;

/* START */
function startGame(){
  menu.classList.remove("active");
  game.classList.add("active");
  menuMusic.play();
  engineSound.play();
  mission.textContent="Mission: Drive 500m";

  setInterval(spawnNPC,1200);
  setInterval(spawnHuman,1800);
  setInterval(spawnBuilding,1500);
  setInterval(spawnPolice,3000);
  setInterval(gameLoop,16);
}

/* CONTROLS */
leftBtn.ontouchstart=()=>moveDir=-1;
rightBtn.ontouchstart=()=>moveDir=1;
leftBtn.ontouchend=rightBtn.ontouchend=()=>moveDir=0;
nitro.ontouchstart=()=>{speed=8;nitroSound.play()}
nitro.ontouchend=()=>speed=4;

/* BUILDINGS */
const buildingImgs=[
  "city/building_1.png",
  "city/building_2.png",
  "city/shop.png",
  "city/house.png"
];
function spawnBuilding(){
  let b=document.createElement("div");
  b.className="building";
  b.style.backgroundImage=`url('${buildingImgs[Math.floor(Math.random()*buildingImgs.length)]}')`;
  b.style.left=Math.random()<.5?"0px":"280px";
  b.style.top="-140px";
  world.appendChild(b);
  buildings.push(b);
}

/* NPC CARS */
function spawnNPC(){
  let c=document.createElement("div");
  c.className="car";
  c.style.backgroundImage="url('cars/npc_car.png')";
  c.style.left=roadLeft+Math.random()*(roadRight-roadLeft)+"px";
  c.style.top="-120px";
  world.appendChild(c);
  npcs.push(c);
}

/* NPC HUMANS (SPRITE) */
function spawnHuman(){
  let h=document.createElement("div");
  h.className="human";
  h.style.left=Math.random()<.5?"20px":"300px";
  h.style.top="100%";
  h.dataset.frame=0;
  world.appendChild(h);
  humans.push(h);
}

/* POLICE */
function spawnPolice(){
  if(wanted<1)return;
  let p=document.createElement("div");
  p.className="car";
  p.style.backgroundImage="url('cars/police.png')";
  p.style.left=roadLeft+80+"px";
  p.style.top="-150px";
  world.appendChild(p);
  police.push(p);
}

/* COLLISION */
function hit(a,b){
  let r1=a.getBoundingClientRect();
  let r2=b.getBoundingClientRect();
  return !(r1.bottom<r2.top||r1.top>r2.bottom||
           r1.right<r2.left||r1.left>r2.right);
}

/* LOOP */
function gameLoop(){
  x+=moveDir*speed;
  if(x<roadLeft)x=roadLeft;
  if(x>roadRight)x=roadRight;
  player.style.left=x+"px";

  score++;
  if(score%60===0)coins++;

  buildings.forEach((b,i)=>{
    b.style.top=b.offsetTop+(3+level)+"px";
    if(b.offsetTop>window.innerHeight){b.remove();buildings.splice(i,1)}
  });

  npcs.forEach((c,i)=>{
    c.style.top=c.offsetTop+(3+level)+"px";
    if(hit(player,c)){crashSound.play();wanted++;c.remove();npcs.splice(i,1)}
  });

  humans.forEach((h,i)=>{
    let f=(+h.dataset.frame+1)%4;
    h.dataset.frame=f;
    h.style.backgroundPosition=`-${f*32}px 0`;
    h.style.top=h.offsetTop-1+"px";
    if(hit(player,h)){crashSound.play();wanted++;h.remove();humans.splice(i,1)}
  });

  police.forEach(p=>{
    p.style.top=p.offsetTop+(4+level)+"px";
    p.style.left=p.offsetLeft+(x-p.offsetLeft)*0.06+"px";
    if(hit(player,p))hp-=1;
  });

  hp.textContent=hp;
  coins.textContent=coins;
  wanted.textContent="★★★★★☆☆☆☆☆".slice(5-wanted,10-wanted);
}
</script>

</body>
</html>
