<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width,initial-scale=1,user-scalable=no">
<title>BOLLYWOOD MAFIA</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial}
body{background:#000;color:#fff;overflow:hidden}

/* Screens */
.screen{position:absolute;inset:0;display:none}
.screen.active{display:flex}

/* MENU */
#menu{
  background:url('menu/menu_bg.jpg') center/cover no-repeat;
  justify-content:center;
  align-items:center;
}
.menu-box{
  background:rgba(0,0,0,.7);
  padding:20px;
  border-radius:16px;
  width:90%;
  max-width:420px;
  text-align:center;
}
.menu-btn{
  width:100%;
  padding:15px;
  margin-top:12px;
  font-size:18px;
  border-radius:12px;
  border:none;
  background:#e91e63;
  color:#fff;
}

/* GAME */
#game{background:#111}
#road{
  position:absolute;
  left:30%;
  width:40%;
  height:100%;
  background:url('road/road_city.png') center/cover no-repeat;
}

/* ENTITIES */
.car{
  position:absolute;
  width:50px;height:90px;
  background-size:contain;
  background-repeat:no-repeat;
}
.human{
  position:absolute;
  width:40px;height:40px;
  background:url('humans/npc_human.png') center/contain no-repeat;
}
#player{bottom:90px}

/* HUD */
#hud{
  position:absolute;
  top:10px;left:10px;right:10px;
  display:flex;
  justify-content:space-between;
  font-size:14px;
}
#wanted{color:gold}

/* MISSION */
#mission{
  position:absolute;
  top:40px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,.6);
  padding:6px 12px;
  border-radius:8px;
  font-size:13px;
}

/* CONTROLS */
#controls{
  position:absolute;
  bottom:0;left:0;right:0;
  display:flex;
  justify-content:space-around;
  padding:10px;
  background:linear-gradient(#222,#000);
}
.ctrl{
  width:80px;height:80px;
  border-radius:50%;
  background:radial-gradient(circle,#555,#111);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:26px;
}
#nitro{
  background:radial-gradient(circle,#ffd700,#b8860b);
  color:#000;
}

/* PAUSE */
#pause{
  position:absolute;
  top:60px;right:10px;
  width:50px;height:50px;
  background:#333;border-radius:10px;
  display:flex;align-items:center;justify-content:center;
}
</style>
</head>

<body>

<!-- AUDIO -->
<audio id="menuMusic" src="sounds/menu_music.mp3" loop></audio>
<audio id="engineSound" src="sounds/engine.mp3" loop></audio>
<audio id="nitroSound" src="sounds/nitro.mp3"></audio>
<audio id="crashSound" src="sounds/crash.mp3"></audio>

<!-- MENU -->
<div id="menu" class="screen active">
  <div class="menu-box">
    <h1>2D MAFIA</h1>
    <p>Coins: <span id="mCoins">0</span></p>
    <p>Best Score: <span id="best">0</span></p>
    <p>Mission: <span id="lastMission">None</span></p>
    <button class="menu-btn" onclick="startGame()">START</button>
  </div>
</div>

<!-- GAME -->
<div id="game" class="screen">
  <div id="road"></div>
  <div id="player" class="car"></div>

  <div id="hud">
    <div>HP: <span id="hp">100</span></div>
    <div id="wanted">☆☆☆☆☆</div>
    <div>Coins: <span id="coins">0</span></div>
  </div>

  <div id="mission"></div>

  <div id="pause" onclick="togglePause()">⏸</div>

  <div id="controls">
    <div class="ctrl" ontouchstart="move(-40)">◀</div>
    <div class="ctrl" id="nitro" ontouchstart="useNitro()">N</div>
    <div class="ctrl" ontouchstart="move(40)">▶</div>
  </div>
</div>

<script>
/* SAVE */
let save=JSON.parse(localStorage.getItem("mafiaSave")||"{}");
let coins=save.coins||0;
let best=save.best||0;
let lastMission=save.mission||"None";

mCoins.textContent=coins;
best.textContent=best;
lastMission.textContent=lastMission;

/* GAME STATE */
let x=window.innerWidth/2;
let score=0,hp=100,wanted=0;
let paused=false,run=false;
let npcs=[],humans=[],police=[];
let missionText="";

/* AUDIO */
const menuMusic=document.getElementById("menuMusic");
const engineSound=document.getElementById("engineSound");

function startGame(){
  menuMusic.play();        // allowed after click
  engineSound.play();
  show("game");
  run=true;
  score=0;hp=100;wanted=0;
  player.style.backgroundImage="url('cars/player_red.png')";
  generateMission();
  setInterval(spawnNPC,1500);
  setInterval(spawnHuman,2500);
  setInterval(spawnPolice,4000);
  loop();
}

/* MISSIONS */
function generateMission(){
  const list=[
    "Drive 500m",
    "Avoid civilians",
    "Survive police chase"
  ];
  missionText=list[Math.floor(Math.random()*list.length)];
  mission.textContent="Mission: "+missionText;
}

/* CONTROLS */
function move(v){x+=v}
function useNitro(){nitroSound.play()}

/* SPAWNS */
function spawnNPC(){
  let c=document.createElement("div");
  c.className="car";
  c.style.backgroundImage="url('cars/npc_car.png')";
  c.style.left=30+Math.random()*40+"%";
  c.style.top="-100px";
  game.appendChild(c);
  npcs.push(c);
}
function spawnHuman(){
  let h=document.createElement("div");
  h.className="human";
  h.style.left=Math.random()<.5?"12%":"85%";
  h.style.top=window.innerHeight+"px";
  game.appendChild(h);
  humans.push(h);
}
function spawnPolice(){
  if(wanted<1)return;
  let p=document.createElement("div");
  p.className="car";
  p.style.backgroundImage="url('cars/police.png')";
  p.style.top="-150px";
  p.style.left="50%";
  game.appendChild(p);
  police.push(p);
}

/* COLLISION */
function hit(a,b){
  let r1=a.getBoundingClientRect();
  let r2=b.getBoundingClientRect();
  return !(r1.bottom<r2.top||r1.top>r2.bottom||
           r1.right<r2.left||r1.left>r2.right);
}

/* LOOP */
function loop(){
  if(!run)return;

  player.style.left=x+"px";
  score++;
  if(score%120===0)coins++;

  npcs.forEach((c,i)=>{
    c.style.top=c.offsetTop+4+"px";
    if(hit(player,c)){damage(10);addWanted();c.remove();npcs.splice(i,1)}
  });

  humans.forEach((h,i)=>{
    h.style.top=h.offsetTop-2+"px";
    if(hit(player,h)){damage(15);addWanted();h.remove();humans.splice(i,1)}
  });

  police.forEach((p,i)=>{
    p.style.top=p.offsetTop+(6+wanted)+"px";
    p.style.left=p.offsetLeft+(x-p.offsetLeft)*0.05+"px";
    if(hit(player,p))damage(20);
  });

  hpEl.textContent=hp;
  coinsEl.textContent=coins;
  wantedEl.textContent="★★★★★☆☆☆☆☆".slice(5-wanted,10-wanted);

  requestAnimationFrame(loop);
}

/* DAMAGE / WANTED */
function damage(d){
  crashSound.play();
  hp-=d;
  if(hp<=0)gameOver();
}
function addWanted(){
  if(wanted<5)wanted++;
}

/* GAME OVER */
function gameOver(){
  run=false;
  engineSound.pause();
  localStorage.setItem("mafiaSave",JSON.stringify({
    coins,
    best:Math.max(best,score),
    mission:missionText
  }));
  location.reload();
}

/* PAUSE */
function togglePause(){
  paused=!paused;
  paused?engineSound.pause():engineSound.play();
}

/* SCREEN */
function show(id){
  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}
</script>

</body>
</html>
